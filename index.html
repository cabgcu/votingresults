<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lip Sync 2025 • Admin Dashboard</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, collection, query, onSnapshot, doc, setDoc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

/* === Firebase Config (same as main site) === */
const firebaseConfig = {
  apiKey: "AIzaSyBoYf1_IhILJ96Y9KMcwrVjHMFLT5YEKuQ",
  authDomain: "lip-sync-2025.firebaseapp.com",
  projectId: "lip-sync-2025",
  storageBucket: "lip-sync-2025.firebasestorage.app",
  messagingSenderId: "118581305479",
  appId: "1:118581305479:web:7a7335c1be6e816cc7d822",
  measurementId: "G-NQ0GMG05Q2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* === Globals === */
let votingEnabled = true;
const statusLabel = document.getElementById('status-label');
const resultsList = document.getElementById('results-list');
const toggleBtn = document.getElementById('toggle-btn');
const clearBtn = document.getElementById('clear-btn');

/* === Firestore Listeners === */
function subscribeToVotes() {
  const q = query(collection(db, 'lip_sync_2025_votes'));
  onSnapshot(q, snap => {
    const counts = {option1:0,option2:0,option3:0,option4:0,option5:0,option6:0};
    snap.forEach(d => { if (d.data().voteId in counts) counts[d.data().voteId]++; });
    renderResults(counts);
  });

  onSnapshot(doc(db, 'lip_sync_2025_settings', 'state'), snap => {
    if (snap.exists()) {
      votingEnabled = snap.data().enabled;
      updateStatus();
    }
  });
}

/* === UI Logic === */
function renderResults(counts) {
  const names = ['Below', 'Deliverance', 'Mask Off', 'Metro Motion', 'Sin Games', 'Anonymity'];
  const total = Object.values(counts).reduce((a,b)=>a+b,0);
  resultsList.innerHTML = Object.keys(counts).map((id,i)=>{
    const pct = total ? ((counts[id]/total)*100).toFixed(1) : 0;
    return `<div class="space-y-1 text-white">
      <div class="flex justify-between text-sm"><span>${names[i]}</span><span>${counts[id]} votes (${pct}%)</span></div>
      <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden"><div class="h-full bg-green-500" style="width:${pct}%"></div></div>
    </div>`;
  }).join('');
  document.getElementById('total-votes').textContent = `Total Votes: ${total}`;
}

function updateStatus() {
  statusLabel.textContent = votingEnabled ? "Voting: ON" : "Voting: OFF";
  toggleBtn.textContent = votingEnabled ? "Turn Off Voting" : "Turn On Voting";
  statusLabel.className = votingEnabled ? "text-green-400 font-semibold" : "text-red-400 font-semibold";
}

/* === Admin Controls === */
async function toggleVoting() {
  votingEnabled = !votingEnabled;
  await setDoc(doc(db, 'lip_sync_2025_settings', 'state'), { enabled: votingEnabled });
  updateStatus();
}

async function clearResults() {
  if (!confirm("Are you sure you want to permanently delete all votes?")) return;
  const qSnap = await getDocs(collection(db, 'lip_sync_2025_votes'));
  const deletions = qSnap.docs.map(d => deleteDoc(d.ref));
  await Promise.all(deletions);
  alert("All votes cleared successfully!");
}

/* === Init === */
subscribeToVotes();
toggleBtn.addEventListener('click', toggleVoting);
clearBtn.addEventListener('click', clearResults);
</script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
body {
  font-family: 'Inter', sans-serif;
  background: radial-gradient(circle at top left, #1c0f29, #0c0a15);
  color: white;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}
.glass {
  background-color: rgba(0,0,0,0.5);
  backdrop-filter: blur(24px);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 1rem;
  padding: 2rem;
  width: 90%;
  max-width: 640px;
  box-shadow: 0 0 20px rgba(255,105,180,0.2);
}
@keyframes wicked-glow {
  0% { box-shadow: 0 0 15px 2px rgba(255,105,180,0.6); }
  50% { box-shadow: 0 0 25px 4px rgba(96,163,77,0.9); }
  100% { box-shadow: 0 0 15px 2px rgba(255,105,180,0.6); }
}
.glow {
  animation: wicked-glow 5s ease-in-out infinite;
}
button {
  transition: all .3s ease;
}
button:hover {
  transform: scale(1.03);
}
</style>
</head>

<body>
  <div class="glass glow text-center">
    <h1 class="text-3xl font-bold mb-2">Lip Sync 2025 • Admin Dashboard</h1>
    <p id="status-label" class="text-green-400 font-semibold mb-4">Voting: ON</p>
    <p id="total-votes" class="text-white/70 mb-6 text-sm">Total Votes: 0</p>

    <div class="flex justify-center gap-3 mb-6">
      <button id="toggle-btn" class="px-4 py-2 border border-white/40 rounded-lg text-white text-sm bg-black">Turn Off Voting</button>
      <button id="clear-btn" class="px-4 py-2 border border-white/40 rounded-lg text-white text-sm bg-black">Clear Results</button>
    </div>

    <div id="results-list" class="space-y-4 text-white"></div>

    <p class="text-sm text-white/60 mt-8">Live results update in real-time as votes are cast.</p>
  </div>
</body>
</html>
